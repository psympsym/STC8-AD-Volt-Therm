C51 COMPILER V9.60.0.0   AD                                                                06/14/2023 10:49:16 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE AD
OBJECT MODULE PLACED IN .\Objects\AD.obj
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE User\AD.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\User;.\Drivers;.\STC8Ax_LIB\Cor
                    -e\Startup;.\STC8Ax_LIB\inc;.\STC8Ax_LIB\Core) DEBUG OBJECTEXTEND PRINT(.\Listings\AD.lst) OBJECT(.\Objects\AD.obj)

line level    source

   1          /*-------------------------------------------------------------------------------
   2          /*       (C) Copyright 2023, PSYM. All Rights Reserved 
   3          /*-------------------------------------------------------------------------------
   4          /* File name   : AD.c
   5          /* Description : 
   6          /* Author      : PSYM
   7          /*-------------------------------------------------------------------------------
   8          /* Update note:
   9          /* -----------   -----------   --------------------------------------------------
  10          /*    Date         Author                              Note
  11          /* -----------   -----------   --------------------------------------------------
  12          /* 2023-06-08       PSYM
  13          /*   14:50
  14          **/
  15          
  16          /* ---------------------------------- 包含头文件 ---------------------------------- */
  17          #include "AD.h"
  18          
  19          /* ---------------------------------- 私有宏定义 ---------------------------------- */
  20          #define VCC 3300 // 电源电压mv
  21          #define ADC_RES_12BIT 4096 // 12位采样分辨率
  22          
  23          /* ---------------------------------- 私有类型定义 ---------------------------------- */
  24          sbit ADC_IO = P0 ^ 0; // ADC通道选择端口
  25          sbit ADC_CFG = 0xDE; // ADC配置寄存器
  26          
  27          /* ---------------------------------- 私有变量 ---------------------------------- */
  28          uint16 ADC_Value = 0; // ADC转换结果
  29          int16 tmp = 0;          // 转换温度值
  30          uint32 voltage = 0; // 实际电压值
  31          
  32          /* ---------------------------------- 扩展变量 ---------------------------------- */
  33          /* None. */
  34          
  35          /* ---------------------------------- 私有函数原型 ---------------------------------- */
  36          void AD_Start();
  37          
  38          /* ---------------------------------- 函数体 ---------------------------------- */
  39          
  40          /**
  41           * @brief: None
  42           * @param: None
  43           * @return: None
  44           * @note: None
  45           */
  46          void AD_Init()
  47          {
  48   1          ADC_CONTR &= 0xF0; // 清除模拟通道选择位
  49   1          ADC_CONTR |= 0x08; // 设置ADC模拟通道 P0.0
  50   1      
  51   1          ADC_CFG &= 0x00; // 清除所有标志位
  52   1          ADC_CFG |= 0x00; // 设置ADC转换结果为左对齐
  53   1          ADC_CFG |= 0x0F; // 设置ADC时钟频率
  54   1      
C51 COMPILER V9.60.0.0   AD                                                                06/14/2023 10:49:16 PAGE 2   

  55   1              AD_Start(); // 开启ADC转换
  56   1      }
  57          
  58          void AD_Start()
  59          {
  60   1          ADC_CONTR |= 0x80; // 开启ADC电源
  61   1              Delay_ms(1);
  62   1          ADC_CONTR |= 0x40; // 启动ADC转换
  63   1      }
  64          
  65          /**
  66           * @brief: 采样转换
  67          */
  68          void Sampl()
  69          {
  70   1              AD_Start();
  71   1      
  72   1              while (!(ADC_CONTR & 0x20))
  73   1                      ; //等待ADC转换完成
  74   1              ADC_Value = ADC_RES << 4;
  75   1              ADC_Value |= ADC_RESL >> 4;
  76   1      
  77   1              voltage = VCC * (uint32)ADC_Value / ADC_RES_12BIT; // 电压值
  78   1              tmp = NTC_TempValue_Calculate(voltage);
  79   1      
  80   1              ADC_CONTR &= 0xDF; //清除ADC转换完成标志位
  81   1      }
  82          /*>>>>>>>>>> (C) COPYRIGHT PSYM <<<<<< >>>>>> END OF FILE <<<<<<<<<<*/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     97    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
